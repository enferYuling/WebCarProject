<!DOCTYPE html>

<html>

<head>
    <title>WebRTC Playback</title>
    
</head>

<body>
    <script src="../js/mux/mux.min.js"></script>
    <script src="../js/signalr/dist/browser/signalr.min.js"></script>
    <video id="videoPlayer" autoplay controls width="600" height="600"></video>
    <input type="text" id="rtspUrlInput">
    <button onclick="startVideo()">开始播放</button>
    <button onclick="startVideo1()">播放</button>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl('/videoHub')
            .build();

        connection.start().then(() => {
            console.log('Connected to SignalR hub.');
        });

        connection.on('VideoData', (data) => {
            const mediaSource = new MediaSource();
            const video = document.getElementById('videoPlayer');
            video.src = URL.createObjectURL(mediaSource);
       
            mediaSource.addEventListener('sourceopen', () => {
                const sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp9,opus"');
                sourceBuffer.appendBuffer(data);
            });
        });
        function startVideo() {
            const rtspUrl = document.getElementById('rtspUrlInput').value;
            fetch('/API/PlayVideo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(rtspUrl)
            });
        }
        function startVideo1() {
            const rtspUrl = document.getElementById('rtspUrlInput').value;
            fetch('/API/ConvertRstpToWebmAsync', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(rtspUrl)
            });
        }
    </script>
</body>

</html>